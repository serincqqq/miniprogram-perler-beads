<!--index.wxml-->
<navigation-bar title="拼豆图转换器" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<view class="page-container">

  <!-- 图片上传区域 -->
  <view bind:tap="onChooseImage" class="uploader-container">
    <view class="uploader-content">
      <image class="uploader-icon" src="/static/upload.png"></image>
      <text class="uploader-text-main">拖放图片到此处，或<text class="uploader-link">点击选择文件</text></text>
      <text class="uploader-text-sub">支持 JPG, PNG 格式</text>
    </view>
  </view>

  <!-- 参数设置区域 -->
  <view class="card-container">
    <!-- 横轴格子 -->
    <view class="setting-item">
      <text class="setting-label">横轴格子 (10-200):</text>
      <view class="setting-control input-group">
        <input class="setting-input" type="number" value="{{gridSize}}" bindinput="onGridSizeInput" maxlength="3" />
        <button class="setting-button" size="mini" type="primary" bindtap="confirmGridSize">确认</button>
      </view>
    </view>

    <!-- 区域颜色合并 -->
    <view class="setting-item slider-item">
      <text class="setting-label">区域颜色合并: {{mergeLevel}}</text>
      <view class="setting-control slider-group">
        <text class="slider-label-min">少</text>
        <slider class="setting-slider" value="{{mergeLevel}}" min="1" max="100" bindchange="onMergeLevelChange" show-value="{{false}}" activeColor="#8A2BE2" block-size="20" />
        <text class="slider-label-max">多</text>
      </view>
    </view>

    <!-- 选择色板 -->
    <view class="setting-item">
      <text class="setting-label">选择色板:</text>
      <view class="setting-control">
        <picker class="setting-picker" mode="selector" range="{{paletteOptions}}" value="{{paletteIndex}}" bindchange="onPaletteChange">
          <view class="picker-content">
            {{paletteOptions[paletteIndex]}}
            <!-- <image class="picker-arrow" src="/images/down-arrow.png"></image> -->
          </view>
        </picker>
      </view>
    </view>

    <!-- 处理模式 -->
    <view class="setting-item">
      <text class="setting-label">处理模式:</text>
      <view class="setting-control">
        <picker class="setting-picker" mode="selector" range="{{modeOptions}}" value="{{modeIndex}}" bindchange="onModeChange">
          <view class="picker-content">
            {{modeOptions[modeIndex]}}
            <!-- <image class="picker-arrow" src="/images/down-arrow.png"></image>  -->
          </view>
        </picker>
      </view>
    </view>
  </view>
  <view class="result-container">
    <!-- wx:if 控制显示，style 控制尺寸 -->
    <canvas wx:if="{{imagePath}}" id="previewCanvas" type="2d" style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"></canvas>
    <!-- 可以加一个图片未选择时的提示 -->
    <view wx:else class="placeholder-text">请先选择图片</view>
  </view>

  <!-- 网格控制面板 -->
  <view wx:if="{{tempFilePath}}" class="grid-controls">
    <view class="control-section">
      <text class="section-title">网格大小调整</text>
      <view class="button-row">
        <button size="mini" bindtap="decreaseGridSize" class="control-button">缩小网格</button>
        <button size="mini" bindtap="increaseGridSize" class="control-button">放大网格</button>
      </view>
    </view>

    <view class="control-section">
      <text class="section-title">网格位置调整</text>
      <view class="direction-controls">
        <!-- 上按钮 -->
        <button size="mini" bindtap="moveGridUp" class="direction-button">↑</button>

        <!-- 左、右按钮 -->
        <view class="horizontal-buttons">
          <button size="mini" bindtap="moveGridLeft" class="direction-button">←</button>
          <button size="mini" bindtap="moveGridRight" class="direction-button">→</button>
        </view>

        <!-- 下按钮 -->
        <button size="mini" bindtap="moveGridDown" class="direction-button">↓</button>
      </view>
    </view>

    <button size="mini" bindtap="resetGrid" class="reset-button">重置网格</button>
    <button class="setting-button" size="mini" type="primary" bindtap="exportImg">导出</button>
  </view>

</view>